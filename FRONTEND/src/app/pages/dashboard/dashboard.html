<div class="container" style="margin-top: 40px">
  <img
    src="assets/logo2.png"
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.06;
      max-width: 450px;
      width: 75vw;
      z-index: 0;
      pointer-events: none;
    "
  />
  <h4>Bienvenido(a), {{ usuarioActual.nombre }}</h4>
  <p>Rol: {{ rol }}</p>

  <!-- BOTONES SEPARADOS: ADMIN/ENTRENADOR -->
  <div style="display: flex; gap: 20px; margin: 1.6em 0">
    <button
      *ngIf="rol === 'administrador' || rol === 'entrenador'"
      (click)="verUsuarios()"
      class="btn-secondary"
      type="button"
    >
      VER USUARIOS REGISTRADOS
    </button>
    <button
      *ngIf="rol === 'administrador'"
      (click)="abrirFormNuevoUsuario()"
      class="btn"
      type="button"
    >
      CREAR NUEVO USUARIO
    </button>
  </div>

  <!-- BOTÓN CLIENTE: Editar perfil -->
  <button
    *ngIf="rol === 'cliente'"
    (click)="editarUsuario(usuarioActual)"
    class="btn"
    type="button"
    style="margin-bottom: 1.5em"
  >
    EDITAR PERFIL
  </button>

  <!-- TABLA USUARIOS ADMIN/ENTRENADOR -->
  <table *ngIf="mostrarTabla" class="highlight responsive-table">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Rol</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of usuarios">
        <td>{{ u.nombre }}</td>
        <td>{{ u.correo }}</td>
        <td>{{ u.rol }}</td>
        <td>
          <button (click)="editarUsuario(u)" class="btn-flat" type="button">Editar</button>
          <button
            *ngIf="rol === 'administrador'"
            (click)="eliminarUsuario(u._id)"
            class="btn-flat"
            type="button"
            style="color: var(--fit-error)"
          >
            Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- FORM EDICIÓN USUARIO -->
  <form *ngIf="mostrarFormEdicion" style="margin-top: 35px" (ngSubmit)="guardarEdicion()">
    <h5>Editar usuario</h5>
    <div class="input-field">
      <input [(ngModel)]="usuarioEnEdicion.nombre" name="nombre" type="text" required />
      <label class="active">Nombre</label>
    </div>
    <div class="input-field">
      <input [(ngModel)]="usuarioEnEdicion.correo" name="correo" type="email" required />
      <label class="active">Correo</label>
    </div>
    <div class="input-field">
      <input [(ngModel)]="usuarioEnEdicion.telefono" name="telefono" type="text" />
      <label class="active">Teléfono</label>
    </div>
    <div class="input-field">
      <input [(ngModel)]="usuarioEnEdicion.contrasena" name="contrasena" type="password" />
      <label class="active">Nueva contraseña</label>
    </div>

    <!-- SOLO ADMIN puede ver y editar el campo ROL -->
    <div class="input-field" *ngIf="rol === 'administrador'">
      <select [(ngModel)]="usuarioEnEdicion.rol" name="rol" class="browser-default">
        <option value="cliente">Cliente</option>
        <option value="entrenador">Entrenador</option>
        <option value="administrador">Administrador</option>
      </select>
    </div>
    <button type="submit" class="btn">GUARDAR</button>
    <button type="button" (click)="mostrarFormEdicion = false" class="btn-flat">CANCELAR</button>
  </form>

  <!-- FORMULARIO NUEVO USUARIO (solo visible si mostrarFormNuevoUsuario es true) -->
  <div
    style="
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: calc(100vh - 180px);
    "
  >
    <form
      *ngIf="mostrarFormNuevoUsuario"
      style="
        width: 100%;
        max-width: 480px;
        background: #fff6;
        border-radius: 12px;
        box-shadow: 0 2px 18px -6px rgba(65, 50, 46, 0.06);
        padding: 2.7em 2.1em 2.2em 2.1em;
        margin-top: 32px;
      "
      (ngSubmit)="guardarNuevoUsuario()"
    >
      <h5>Nuevo usuario</h5>
      <div class="input-field">
        <select
          [(ngModel)]="nuevoUsuario.tipoID"
          name="nuevoTipoID"
          class="browser-default"
          required
        >
          <option value="">Selecciona tipo de documento</option>
          <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
          <option value="Pasaporte">Pasaporte</option>
          <option value="DNI">DNI</option>
          <option value="Tarjeta de Identidadd">Tarjeta de Identidadd</option>
          <option value="Cédula de Extranjería">Cédula de Extranjería</option>
          <option value="Permiso por Protección Temporal">Permiso por Protección Temporal</option>
        </select>
        <label class="active">Tipo ID</label>
      </div>
      <div class="input-field">
        <input [(ngModel)]="nuevoUsuario.numeroID" name="nuevoNumeroID" type="text" required />
        <label class="active">Número de documento</label>
      </div>
      <div class="input-field">
        <input [(ngModel)]="nuevoUsuario.nombre" name="nuevoNombre" type="text" required />
        <label class="active">Nombre</label>
      </div>
      <div class="input-field">
        <input [(ngModel)]="nuevoUsuario.correo" name="nuevoCorreo" type="email" required />
        <label class="active">Correo</label>
      </div>
      <div class="input-field">
        <input [(ngModel)]="nuevoUsuario.telefono" name="nuevoTelefono" type="text" />
        <label class="active">Teléfono</label>
      </div>
      <div class="input-field">
        <input
          [(ngModel)]="nuevoUsuario.contrasena"
          name="nuevoContrasena"
          type="password"
          required
        />
        <label class="active">Contraseña</label>
      </div>
      <div class="input-field">
        <select [(ngModel)]="nuevoUsuario.rol" name="nuevoRol" class="browser-default">
          <option value="cliente">Cliente</option>
          <option value="entrenador">Entrenador</option>
          <option value="administrador">Administrador</option>
        </select>
      </div>
      <button type="submit" class="btn">CREAR</button>
      <button type="button" (click)="cerrarFormNuevoUsuario()" class="btn-flat">CANCELAR</button>
    </form>
  </div>
</div>
